import pandas as pd
import nltk
import pymorphy3
from spell_checker import SpellChecker
nltk.download('stopwords')
from pathlib import Path

BASE_DIR = Path(__file__).parent

ORFO_DATASET_PATH = BASE_DIR / "data" / "orfo_and_typos.L1_5+PHON.csv"
KARTASLOVSENT_PATH = BASE_DIR / "data" / "kartaslovsent.csv"

THRESHOLD = -0.93

replace_map = [
    {'bI': 'ы'},
    {'3.14': 'пи'},
    {'3,14': 'пи'},
    {'314': "пи"},
    
    {'α': 'а'}, {'β': 'в'}, {'γ': 'г'},
    {'δ': 'д'}, {'ε': 'е'}, {'ζ': 'з'},
    {'η': 'н'}, {'θ': 'т'}, {'ι': 'и'},
    {'κ': 'к'}, {'λ': 'л'}, {'μ': 'м'},
    {'ν': 'н'}, {'ξ': 'кс'}, {'ο': 'о'},
    {'π': 'п'}, {'ρ': 'р'}, {'σ': 'с'},
    {'τ': 'т'}, {'υ': 'у'}, {'φ': 'ф'},
    {'χ': 'х'}, {'ψ': 'щ'}, {'ω': 'ш'},
    
    {'€': 'е'}, {'£': 'е'}, {'¥': 'у'}, {'©': 'с'}, {"$": "с"},
    
    {'0': 'о'}, {'1': 'и'}, {'3': 'з'}, {'4': 'ч'},
    {'5': 'б'}, {'6': 'б'}, {'7': 'т'}, {'8': 'в'}, {'9': 'д'},
    
    {'a': 'а'}, {'b': 'ь'}, {'c': 'с'}, {'d': 'д'},
    {'e': 'е'}, {'f': 'ф'}, {'g': 'д'}, {'h': 'н'},
    {'i': 'и'}, {'j': 'ж'}, {'k': 'к'}, {'l': 'л'},
    {'m': 'м'}, {'n': 'н'}, {'o': 'о'}, {'p': 'р'},
    {'q': 'ку'}, {'r': 'р'}, {'s': 'с'}, {'t': 'т'},
    {'u': 'и'}, {'v': 'в'}, {'w': 'ш'}, {'x': 'х'},
    {'y': 'у'}, {'z': 'з'},
    
    {'A': 'А'}, {'B': 'В'}, {'C': 'С'}, {'D': 'Д'},
    {'E': 'Е'}, {'F': 'Ф'}, {'G': 'Д'}, {'H': 'Н'},
    {'I': 'И'}, {'J': 'Ж'}, {'K': 'К'}, {'L': 'Л'},
    {'M': 'М'}, {'N': 'Н'}, {'O': 'О'}, {'P': 'Р'},
    {'Q': 'КУ'}, {'R': 'Р'}, {'S': 'С'}, {'T': 'Т'},
    {'U': 'У'}, {'V': 'В'}, {'W': 'Ш'}, {'X': 'Х'},
    {'Y': 'У'}, {'Z': 'З'},
    
    {'6': 'б'}, {'@': 'а'}, {"1": "и"}
]

mat_regex = r"""(?iux)(?<![а-яё])(?:
# Исходные матерные паттерны (с поддержкой дефисов и пробелов)
(?:(?:у|[- ]*[нз][- ]*а|(?:х[- ]*и[- ]*т[- ]*р[- ]*о|н[- ]*е)?[- ]*в[- ]*з?[- ]*[ыьъ]|[- ]*с[- ]*[ьъ]|(?:и|р[- ]*а)[- ]*[зс][- ]*ъ?|(?:о[- ]*[тб]|п[- ]*[оа][- ]*д)[- ]*[ьъ]?|(?:\S(?=[а-яё]))+?[- ]*[оаеи][- ]*)[- ]*)?(?:
  [- ]*[её][- ]*(?:[- ]*б(?![- ]*о[- ]*[рй]|[- ]*р[- ]*а[- ]*ч)|[- ]*п[- ]*[уа][- ]*(?:[- ]*ц|[- ]*т[- ]*с))|
  [- ]*и[- ]*[пб][- ]*[ае][- ]*[тцд][- ]*[ьъ]
).*?|

(?:(?:н[- ]*[иеа]|(?:р[- ]*а|и)[- ]*[зс]|[- ]*[зд][- ]*?[ао][- ]*(?:т|д[- ]*н[- ]*[оа])?|[- ]*с[- ]*(?:м[- ]*[еи])?|[- ]*а[- ]*[пб][- ]*ч|[- ]*в[- ]*[ъы]?|[- ]*п[- ]*р[- ]*[еи])[- ]*)?х[- ]*у(?:[- ]*[яйиеёю]|[- ]*л+[- ]*и(?!г[- ]*а[- ]*н)).*?|

б[- ]*л(?:[- ]*[эя]|[- ]*е[- ]*а?)(?:[- ]*[дт][- ]*[ьъ]?)?|

\S*?(?:
  п[- ]*(?:
    (?:[- ]*[иеё][- ]*[зс][- ]*д|[- ]*з[- ]*д)[- ]*(?:[- ]*[еёц])? |  
    [- ]*[иеё][- ]*з[- ]*д|  
    [- ]*и[- ]*д[- ]*[аое][- ]*?р|
    [- ]*е[- ]*д(?:[- ]*р(?![- ]*о)|[- ]*[аое][- ]*р|[- ]*и[- ]*к)|
    [- ]*о[- ]*х[- ]*у[- ]*ю
  )|
  б[- ]*л[- ]*я(?:[- ]*[дбц]|[- ]*т[- ]*с)|
  [- ]*[ое][- ]*х[- ]*у[- ]*[яйиеё]|
  х[- ]*у[- ]*й[- ]*н
).*?|

(?:о[- ]*[тб]?|п[- ]*р[- ]*о|н[- ]*а|в[- ]*ы)?м[- ]*(?:
  а[- ]*н[- ]*д(?:[- ]*[ауеыий](?:[- ]*л(?:[- ]*и[- ]*[сзщ])?[- ]*[ауеийы])?|[- ]*о[- ]*й|[- ]*[ао][- ]*в.*?|[- ]*ю[- ]*к(?:[- ]*о[- ]*в|[- ]*[ауий])?|[- ]*е[- ]*[нт][- ]*ь|[- ]*и[- ]*щ[- ]*а)|
  у[- ]*д(?:[- ]*[яаийое].+?|[- ]*е?[- ]*н(?:[- ]*[ьюийя]|[- ]*е[- ]*й))|
  [- ]*[ао][- ]*л[- ]*[ао][- ]*ф[- ]*[ьъ](?:[- ]*[яийюе]|[- ]*[её][- ]*о[- ]*й)
)|

е[- ]*л[- ]*д[- ]*[ауые].*?|
л[- ]*я[- ]*[тд][- ]*ь|
(?:[- ]*[нз][- ]*а|п[- ]*о)[- ]*х|

# Грубые/оскорбительные слова (не мат)
# 1. Общие оскорбления
(?:у[- ]*р[- ]*о[- ]*д[- ]*[а-яё-]*|д[- ]*е[- ]*б[- ]*и[- ]*[лчв][- ]*[а-яё-]*|д[- ]*а[- ]*у[- ]*н[- ]*[а-яё-]*|к[- ]*р[- ]*е[- ]*т[- ]*[ий][- ]*н[- ]*[а-яё-]*|[ий][- ]*д[- ]*[ио][- ]*[ао][- ]*т[- ]*[а-яё-]*|д[- ]*о[- ]*л[- ]*б[- ]*о[- ]*[ёе][- ]*б[- ]*[а-яё-]*|
п[- ]*р[- ]*[ий][- ]*д[- ]*у[- ]*р[- ]*[а-яё-]*|о[- ]*т[- ]*м[- ]*о[- ]*р[- ]*о[- ]*з[- ]*[а-яё-]*|г[- ]*н[- ]*и[- ]*д[- ]*[а-яё-]*|п[- ]*о[- ]*д[- ]*о[- ]*н[- ]*[а-яё-]*|о[- ]*т[- ]*б[- ]*р[- ]*о[- ]*с[- ]*[а-яё-]*|м[- ]*е[- ]*р[- ]*з[- ]*а[- ]*в[- ]*[а-яё-]*|
н[- ]*е[- ]*г[- ]*о[- ]*д[- ]*я[- ]*[йя][- ]*[а-яё-]*|п[- ]*о[- ]*д[- ]*л[- ]*е[- ]*ц[- ]*[а-яё-]*|[ий][- ]*с[- ]*ч[- ]*а[- ]*д[- ]*[ий][- ]*[а-яё-]*|ч[- ]*м[- ]*[оыа][- ]*[а-яё-]*|л[- ]*о[- ]*х[- ]*[а-яё-]*|
п[- ]*а[- ]*д[- ]*л[- ]*[уайея][- ]*|п[- ]*а[- ]*д[- ]*л[- ]*ю[- ]*[кг][- ]*[а-яё-]*|и[- ]*м[- ]*б[- ]*и[- ]*ц[- ]*и[- ]*л[- ]*[а-яё-]*|
д[- ]*у[- ]*р[- ]*[а-яё]*|м[- ]*у[- ]*д(?:[а-яё-]+[а-яё-]|[- ]*[^а-яё-])[а-яё-]*)|

# 2. Животные-оскорбления
(?:с[- ]*к[- ]*о[- ]*т[- ]*[ий][- ]*н[- ]*[а-яё-]*|п[- ]*с[- ]*[ий][- ]*н[- ]*[а-яё-]*|с[- ]*в[- ]*[ий][- ]*н[- ]*ь[- ]*[яий][- ]*[а-яё-]*|о[- ]*в[- ]*ц[- ]*[аеы][- ]*[а-яё-]*|к[- ]*о[- ]*з[- ]*[ёе][- ]*л[- ]*[а-яё-]*|б[- ]*з[- ]*д[- ]*[а-яё-]*)|

# 3. Сексуально-оскорбительные и разврат
(?:ш[- ]*л[- ]*ю[- ]*х[- ]*[а-яё-]*|п[- ]*р[- ]*о[- ]*с[- ]*т[- ]*[ий][- ]*т[- ]*у[- ]*[а-яё-]*|б[- ]*л[- ]*у[- ]*д[- ]*н[- ]*[ий][- ]*ц[- ]*[а-яё-]*|р[- ]*а[- ]*з[- ]*в[- ]*р[- ]*а[- ]*т[- ]*н[- ]*[ий][- ]*к[- ]*[а-яё-]*|п[- ]*о[- ]*х[- ]*о[- ]*т[- ]*[а-яё-]*|б[- ]*л[- ]*я[- ]*д[- ]*[а-яё-]*|
с[- ]*о[- ]*д[- ]*о[- ]*м[- ]*[а-яё-]*|г[- ]*о[- ]*м[- ]*о[- ]*с[- ]*е[- ]*к[- ]*[а-яё-]*|п[- ]*е[- ]*д[- ]*о[- ]*ф[- ]*[ий][- ]*л[- ]*[а-яё-]*|и[- ]*з[- ]*в[- ]*р[- ]*а[- ]*щ[- ]*е[- ]*н[- ]*[а-яё-]*|п[- ]*р[- ]*[ио][- ]*с[- ]*т[- ]*[ио][- ]*т[- ]*[а-яё-]*|с[- ]*е[- ]*к[- ]*с[- ]*о[- ]*т[- ]*[а-яё-]*|
т[- ]*р[- ]*а[- ]*х[- ]*[а-яё]*|е[- ]*б[- ]*[а-яё-]*|п[- ]*о[- ]*р[- ]*н[- ]*о[- ]*[а-яё-]*|в[- ]*а[- ]*г[- ]*[ий][- ]*н[- ]*[а-яё-]*|ч[- ]*л[- ]*е[- ]*н[- ]*[а-яё-]*|с[- ]*о[- ]*с[- ]*[аий][- ]*[а-яё-]*|ж[- ]*о[- ]*п[- ]*[а-яё-]*|б[- ]*л[- ]*у[- ]*д[- ]*[а-яё-]*|б[- ]*л[- ]*у[- ]*д[- ]*н[- ]*[ий][- ]*к[- ]*[а-яё-]*|
м[- ]*[ий][- ]*н[- ]*е[- ]*т[- ]*[а-яё-]*|г[- ]*а[- ]*н[- ]*д[- ]*о[- ]*н[- ]*[а-яё-]*|м[- ]*[ий][- ]*н[- ]*ь[- ]*е[- ]*т[- ]*)|

# 4. Алкоголь и наркотики
(?:а[- ]*л[- ]*к[- ]*а[- ]*ш[- ]*[а-яё-]*|п[- ]*ь[- ]*я[- ]*н[- ]*ь[- ]*[а-яё-]*|б[- ]*у[- ]*х[- ]*л[- ]*[ао][- ]*[а-яё-]*|н[- ]*а[- ]*р[- ]*к[- ]*о[- ]*м[- ]*а[- ]*н[- ]*[а-яё-]*|д[- ]*о[- ]*з[- ]*[а-яё-]*|г[- ]*е[- ]*р[- ]*о[- ]*(?:[ий](?!ня)[- ]*н[- ]*[а-яё-]*|й[- ]*н[- ]*[а-яё-]*)|
к[- ]*о[- ]*к[- ]*с[- ]*[а-яё-]*|а[- ]*н[- ]*а[- ]*ш[- ]*[а-яё-]*|с[- ]*п[- ]*а[- ]*[ий][- ]*с[- ]*[а-яё-]*|ш[- ]*[ий][- ]*р[- ]*[а-яё-]*|т[- ]*о[- ]*р[- ]*ч[- ]*[а-яё-]*|д[- ]*р[- ]*ю[- ]*ч[- ]*[а-яё-]*|к[- ]*о[- ]*л[- ]*[ёе][- ]*ц[- ]*[а-яё-]*|
м[- ]*а[- ]*р[- ]*[ий][- ]*х[- ]*у[- ]*а[- ]*н[- ]*[а-яё-]*|г[- ]*а[- ]*ш[- ]*[а-яё-]*|п[- ]*[ао][- ]*р[- ]*н[- ]*[а-яё-]*|з[- ]*а[- ]*к[- ]*л[- ]*а[- ]*д[- ]*[а-яё-]*|д[- ]*р[- ]*я[- ]*н[- ]*ь[- ]*[а-яё-]*)|

# 5. Социальные оскорбления
(?:б[- ]*о[- ]*м[- ]*ж[- ]*[а-яё-]*|п[- ]*а[- ]*р[- ]*а[- ]*з[- ]*[ий][- ]*т[- ]*[а-яё-]*|ш[- ]*а[- ]*р[- ]*о[- ]*м[- ]*ы[- ]*ж[- ]*н[- ]*[ий][- ]*к[- ]*[а-яё-]*|у[- ]*б[- ]*л[- ]*ю[- ]*д[- ]*[а-яё-]*|в[- ]*ы[- ]*б[- ]*л[- ]*я[- ]*д[- ]*[а-яё-]*|б[- ]*и[- ]*ч[- ]*[а-яё-]*)|

# 6. "Грязные" слова
(?:[гж][- ]*а[- ]*[вф][- ]*н[- ]*[аоы]|г[- ]*[ао][- ]*в[- ]*н[- ]*[а-яё-]*[- ]*|г[- ]*[оа][- ]*в[- ]*е[- ]*н[- ]*[а-яё-]*|г[- ]*[ао][- ]*в[- ]*н[- ]*ю[- ]*[кч]|д[- ]*е[- ]*р[- ]*ь[- ]*м[- ]*[аоуы]|д[- ]*е[- ]*р[- ]*[ьъ][- ]*м[- ]*[аоу]|д[- ]*[еи][- ]*р[- ]*ь[- ]*м[- ]*[а-яё-]*)|

# 7. Оскорбления женского рода (обновлено)
(?:с[- ]*[ую][- ]*[кч][- ]*[аиуео]|с[- ]*у[- ]*ч[- ]*[аиьо][- ]*[йея]|с[- ]*у[- ]*ч[- ]*к[- ]*[аиу]|с[- ]*у[- ]*ч[- ]*ь[- ]*[еяий]|с[- ]*т[- ]*е[- ]*р[- ]*в[- ]*[а-яё-]*|х[- ]*р[- ]*ы[- ]*ч[- ]*[а-яё-]*|
ш[- ]*м[- ]*а[- ]*р[- ]*[а-яё-]*|ш[- ]*в[- ]*а[- ]*л[- ]*[а-яё-]*|ш[- ]*л[- ]*ю[- ]*х[- ]*[а-яё-]*|б[- ]*л[- ]*я[- ]*д[- ]*[а-яё-]*|п[- ]*о[- ]*т[- ]*а[- ]*с[- ]*к[- ]*[а-яё-]*|п[- ]*р[- ]*[оа][- ]*л[- ]*[её][- ]*т[- ]*к[- ]*[а-яё-]*)|

# 8. Другие
(?:х[- ]*а[- ]*м[- ]*[а-яё-]*|х[- ]*а[- ]*м[- ]*л[- ]*[ао][- ]*[а-яё-]*|м[- ]*р[- ]*а[- ]*з[- ]*[аоуий][- ]*|м[- ]*р[- ]*а[- ]*з[- ]*[ийь][- ]*|м[- ]*р[- ]*а[- ]*з[- ]*о[- ]*т[- ]*[а-яё-]*|а[- ]*у[- ]*т[- ]*[ий][- ]*с[- ]*т[- ]*[а-яё-]*|а[- ]*х[- ]*у[- ]*е[- ]*[а-яё-]*|д[- ]*е[- ]*г[- ]*е[- ]*н[- ]*е[- ]*р[- ]*а[- ]*т[- ]*[а-яё-]*|к[- ]*о[- ]*н[- ]*ч[- ]*[а-яё-]*)
)(?![а-яё])"""

PRONOUNS = ['я', 'ты', 'вы', 'он', 'она', 'оно', 'мы', 'они', 'вас', 'нас', 'их', 'его', 'её']
stopword_set = set(nltk.corpus.stopwords.words('russian'))
stopword_set = stopword_set.union({'это', 'который', 'весь', 'наш', 'свой', 'ещё', 'её', 'ваш', 'также', 'итак'})

words_semantics_dataset = pd.read_csv(KARTASLOVSENT_PATH, sep=";")
# term_to_tag_dict = dict(zip(words_semantics_dataset['term'], words_semantics_dataset['tag']))
term_to_tag_dict = {row['term']: [row['tag'], row['value']] for _, row in words_semantics_dataset.iterrows()}

lemmatizer = pymorphy3.MorphAnalyzer()

checker = SpellChecker(ORFO_DATASET_PATH)

